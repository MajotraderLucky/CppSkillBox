#!/bin/bash

echo "=== Тестирование программы с assert ==="

# Компиляция
echo "Компиляция программы..."
g++ travel_time.cpp -o travel_time
if [ $? -ne 0 ]; then
    echo "Ошибка компиляции!"
    exit 1
fi

# Тест 1: Нормальные значения
echo -e "\n--- Тест 1: Нормальные значения (100 км, 50 км/ч) ---"
echo -e "100\n50" | ./travel_time > test1.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Программа работает с корректными данными"
    cat test1.txt | grep "Время в пути: 2 часов"
else
    echo "НЕ ПРОЙДЕН"
fi

# Тест 2: Нулевая скорость
echo -e "\n--- Тест 2: Нулевая скорость (100 км, 0 км/ч) ---"
echo -e "100\n0" | ./travel_time > test2.txt 2>&1
if [ $? -ne 0 ]; then
    echo "ПРОЙДЕН: Assert срабатывает при нулевой скорости"
    echo "Сообщение об ошибке:"
    grep -E "(assert|Assertion)" test2.txt
else
    echo "НЕ ПРОЙДЕН: Assert не сработал"
fi

# Тест 3: Отрицательная скорость
echo -e "\n--- Тест 3: Отрицательная скорость (100 км, -50 км/ч) ---"
echo -e "100\n-50" | ./travel_time > test3.txt 2>&1
if [ $? -ne 0 ]; then
    echo "ПРОЙДЕН: Assert срабатывает при отрицательной скорости"
    echo "Сообщение об ошибке:"
    grep -E "(assert|Assertion)" test3.txt
else
    echo "НЕ ПРОЙДЕН: Assert не сработал"
fi

# Тест 4: Очень маленькая положительная скорость
echo -e "\n--- Тест 4: Маленькая скорость (100 км, 0.001 км/ч) ---"
echo -e "100\n0.001" | ./travel_time > test4.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Программа работает с маленькими положительными значениями"
    grep "Время в пути:" test4.txt
else
    echo "НЕ ПРОЙДЕН"
fi

# Тест 5: Демонстрация строки с assert
echo -e "\n--- Тест 5: Вывод информации об assert ---"
echo "Пробуем вызвать assert с нулевой скоростью:"
result=$(echo -e "100\n0" | ./travel_time 2>&1)
echo "$result" | grep -E "travel_time.cpp:[0-9]+" && echo "ПРОЙДЕН: Показана строка с assert" || echo "НЕ ПРОЙДЕН: Строка с assert не найдена"

# Тест 6: Отрицательное расстояние
echo -e "\n--- Тест 6: Отрицательное расстояние (-100 км, 50 км/ч) ---"
echo -e "-100\n50" | ./travel_time > test6.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Отрицательное расстояние обрабатывается корректно"
    grep "Время в пути:" test6.txt
else
    echo "НЕ ПРОЙДЕН: Программа не должна падать при отрицательном расстоянии"
fi

# Тест 7: Нулевое расстояние
echo -e "\n--- Тест 7: Нулевое расстояние (0 км, 50 км/ч) ---"
echo -e "0\n50" | ./travel_time > test7.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Нулевое расстояние обрабатывается корректно"
    grep "Время в пути: 0 часов" test7.txt && echo "Результат: 0 часов (корректно)"
else
    echo "НЕ ПРОЙДЕН"
fi

# Тест 8: Очень большие значения
echo -e "\n--- Тест 8: Большие значения (1000000 км, 1000000 км/ч) ---"
echo -e "1000000\n1000000" | ./travel_time > test8.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Большие значения обрабатываются корректно"
    grep "Время в пути: 1 часов" test8.txt && echo "Результат: 1 час (корректно)"
else
    echo "НЕ ПРОЙДЕН"
fi

# Тест 9: Проверка точности вычислений
echo -e "\n--- Тест 9: Точность вычислений (1 км, 3 км/ч) ---"
echo -e "1\n3" | ./travel_time > test9.txt 2>&1
if [ $? -eq 0 ]; then
    echo "ПРОЙДЕН: Точность вычислений корректна"
    grep "Время в пути: 0.333333 часов" test9.txt && echo "Результат: 0.333333 часа (корректно)"
else
    echo "НЕ ПРОЙДЕН"
fi

# Очистка
rm -f test*.txt

echo -e "\n=== Тестирование завершено ==="